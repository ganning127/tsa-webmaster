import Head from 'next/head'
import { NavBar } from '../components/NavBar/index.tsx'
import { Footer } from '../components/Footer/index.tsx'
import { LeftTextWithButton } from '../components/TwoCol/LeftTextWithButton'
import { Container, Box, Select, VStack, Text, Button, SimpleGrid, Img, Input, FormControl, Link } from '@chakra-ui/react'
import { countryList } from '../data/countries'
import { Spinner } from '@chakra-ui/react'
import { Formik, Form } from 'formik';
export default function SignUp() {
    const handleSubmit = async (event) => {
        event.preventDefault();
        document.getElementById('spinner').style.display = 'block';
        const firstname = document.getElementById('firstname').value;
        const lastname = document.getElementById('lastname').value;
        const gender = document.getElementById('gender').value;
        const country = document.getElementById('country').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        const options = {
            method: 'POST',
            body: JSON.stringify({
                firstname,
                lastname,
                gender,
                country,
                email,
                password
            })
        }

        const resp = await fetch('/api/signup', options);
        const data = await resp.json();
        console.log(data);

        if (data.error) {
            document.getElementById('spinner').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').innerHTML = data.error;
        }
        else {
            document.getElementById('spinner').style.display = 'none';
            localStorage.setItem('token', data.token);
            window.location.href = '/';

        }

    }
    return (
        <Box>
            <Head>
                <title>Login - RoboReach</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.ico" />
            </Head>




            <Box bg='url("/login_bkg.png")' h="100vh" bgRepeat="no-repeat" bgSize="cover" bgPos="center">
                <Container maxW="container.xl" mt="">
                    <SimpleGrid columns={{ base: 1, md: 2 }} spacing={8} alignItems="center" h="100vh" justifyContent="center">
                        <Box d={{ base: 'none', md: 'block' }}>
                            <Img src='/logo_no_small.png' />
                        </Box>
                        <Box>

                            <Formik
                                initialValues={{ name: 'Sasuke' }}
                                onSubmit={(values, actions) => {
                                    setTimeout(() => {
                                        alert(JSON.stringify(values, null, 2))
                                        actions.setSubmitting(false)
                                    }, 1000)
                                }}
                            >
                                <Form onSubmit={handleSubmit} >
                                    <VStack
                                        spacing={4}
                                        align='stretch'
                                        maxW="600px"
                                        mx="auto"
                                    >
                                        <Box>
                                            <Text fontSize='md' mb="0">Welcome back</Text>
                                            <Text fontWeight="bold" fontSize='3xl' color='blue.dark'>Student Sign Up</Text>
                                        </Box>

                                        <Text id='error' bg='red.100' p={1} rounded='md' style={{ display: 'none' }}>Something went wrong, please try again!</Text>


                                        <SimpleGrid columns={{ base: 1, md: 2 }} spacing={4}>
                                            <FormControl isRequired borderRadius="20" color="gray.900">
                                                <Input id='firstname' type="text" placeholder='Name' color="gray.900" />
                                            </FormControl>

                                            <FormControl isRequired borderRadius="20" color="gray.900">
                                                <Input id='lastname' type="text" placeholder='Last Name' color="gray.900" />
                                            </FormControl>
                                        </SimpleGrid>


                                        <SimpleGrid columns={{ base: 1, md: 2 }} spacing={4}>
                                            <FormControl isRequired borderRadius="20" color="gray.900">
                                                <Input id='email' type="email" placeholder='Email' color="gray.900" />
                                            </FormControl>

                                            <FormControl isRequired borderRadius="20" color="gray.900">
                                                <Select id='gender' placeholder='Gender' color="gray.900">
                                                    <option value='male'>Male</option>
                                                    <option value='female'>Female</option>
                                                    <option value='nonbinary'>Nonbinary</option>
                                                    <option value='notsay'>Prefer not to say</option>
                                                </Select>
                                            </FormControl>
                                        </SimpleGrid>

                                        <FormControl isRequired borderRadius="20" color="gray.900">
                                            <Select id='country' color="gray.900" placeholder='Country'>
                                                {countryList.map((country, index) => {
                                                    return (
                                                        <option key={index} value={country}>{country}</option>
                                                    )
                                                })}
                                            </Select>
                                        </FormControl>

                                        <SimpleGrid columns={{ base: 1, md: 2 }} spacing={4}>
                                            <FormControl isRequired borderRadius="20" color="gray.900">
                                                <Input id='password' type="password" placeholder='Password' color="gray.900" />
                                            </FormControl>

                                            <FormControl isRequired borderRadius="20" color="gray.900">
                                                <Input id='confirmPassword' type="password" placeholder='Confirm password' color="gray.900" />
                                            </FormControl>
                                        </SimpleGrid>








                                        <Button color="white" bg="blue.light" _hover={{ bg: "blue.dark" }} type="submit" id='submit'>

                                            <Spinner style={{ display: 'none' }} id='spinner' />
                                            <Text ml="2">Sign Up</Text>

                                        </Button>

                                        <Text>Already have an account? <Link href='/login' bg='gray.100' p={1} rounded='lg'>Log in here!</Link></Text>
                                    </VStack>
                                </Form>
                            </Formik>

                        </Box>

                    </SimpleGrid>
                </Container>
            </Box>





        </Box>
    )
}
